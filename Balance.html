<!DOCTYPE html>
<html lang="de" data-density="compact">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruhestand-Balancing</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- External Stylesheets -->
    <link rel="stylesheet" href="css/balance.css">

    <!-- External Scripts -->
    <script type="module" src="engine.js"></script>
    <script type="module" src="balance-main.js"></script>
</head>
<body>
    <div class="main-layout">
        <div id="engine-version-alert" role="alert" tabindex="-1" style="display:none; padding: 15px; background-color: var(--warning-color); color: #000; font-weight: bold; text-align: center; margin-bottom: 15px; border-radius: 8px; grid-column: 1 / -1;"></div>

        <div class="form-column panel">
            <div class="app-header">
                <h1>Ruhestand-Balancing</h1>
                <div class="app-controls">
                    <button id="jahresabschlussBtn" type="button" class="btn" aria-label="Jahresabschluss erstellen (Alt+J)">‚≠ê Jahresabschluss</button>
                    <button id="exportBtn" type="button" class="btn" aria-label="Export (Alt+E)">üì§ Export</button>
                    <button id="importBtn" type="button" class="btn" aria-label="Import (Alt+I)">üì• Import</button>
                    <input id="importFile" type="file" accept="application/json,.json" style="display:none">
                </div>
            </div>

            <!-- Mode Toggle -->
            <div class="mode-toggle-container">
                <label class="mode-toggle">
                    <span class="mode-label">üéØ Einfach</span>
                    <input type="checkbox" id="modeToggle" class="mode-toggle-input">
                    <span class="mode-toggle-slider"></span>
                    <span class="mode-label">üîß Fortgeschritten</span>
                </label>
            </div>

            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="update">Jahres-Update</button>
                <button class="tab-btn" data-tab="settings">Grundeinstellungen & Strategie</button>
            </div>

            <div class="tab-content">
                <div id="tab-update" class="tab-panel active">
                    <fieldset><legend>Basiswerte</legend>
                        <!-- Jahres-Update Button -->
                        <div class="update-actions" style="margin-bottom: 15px;">
                            <button id="btnJahresUpdate" type="button" class="btn btn-primary" title="Ruft Inflation (ECB) und ETF-Kurs (VWCE.DE) ab, f√ºhrt Nachr√ºcken durch und aktualisiert ATH">üåê Jahres-Update</button>
                            <button id="btnJahresUpdateLog" type="button" class="btn btn-utility btn-icon" aria-label="Protokoll des letzten Jahres-Updates anzeigen" title="Protokoll des letzten Jahres-Updates anzeigen" disabled>üßæ</button>
                        </div>
                        <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="form-group"><label for="aktuellesAlter">Aktuelles Alter</label><input id="aktuellesAlter" type="number" value="65" min="50"></div>
                            <div class="form-group">
                                <label for="inflation">Inflation VJ (%)</label>
                                <input id="inflation" type="number" value="1.7" step="0.1">
                            </div>
                        </div>
						<!-- NEUER CONTAINER F√úR DEN INTELLIGENTEN HINWEIS -->
						<div id="bedarfAnpassungContainer" class="full-width" style="margin-top: 10px; text-align: center;"></div>						
                    </fieldset>
                    <fieldset><legend>Verm√∂gen</legend>
                        <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="form-group"><label for="tagesgeld">Tagesgeld (‚Ç¨)</label><input id="tagesgeld" class="currency" type="text" inputmode="numeric" value="60000"></div>
                            <div class="form-group"><label for="geldmarktEtf">Geldmarkt-ETF (‚Ç¨)</label><input id="geldmarktEtf" class="currency" type="text" inputmode="numeric" value="360000"></div>
                            <div class="form-group"><label for="depotwertAlt">Depotwert Alt (‚Ç¨)</label><input id="depotwertAlt" class="currency" type="text" inputmode="numeric" placeholder="z. B. 1.200.000"></div>
                            <div class="form-group"><label for="depotwertNeu">Depotwert Neu (‚Ç¨)</label><input id="depotwertNeu" class="currency" type="text" inputmode="numeric" placeholder="z. B. 750.000"></div>
                            <div class="form-group" id="goldWertGroup"><label for="goldWert">Gold-Bestand (‚Ç¨)</label><input id="goldWert" class="currency" type="text" inputmode="numeric" value="0"></div>
                        </div>
                    </fieldset>
                    <fieldset class="advanced-only"><legend style="display: flex; justify-content: space-between; align-items: center; width: 100%;">Marktdaten
                        <span style="display: flex; gap: 6px;">
                            <button id="btnCsvImport" type="button" class="btn btn-utility btn-sm" title="Marktdaten aus CSV-Datei importieren">üìÑ CSV</button>
                            <input type="file" id="csvFileInput" accept=".csv" style="display:none">
                            <button id="btnNachruecken" type="button" class="btn btn-utility btn-sm" title="Marktdaten um ein Jahr verschieben (Alt+N)">üóìÔ∏è Nachr.</button>
                            <button id="btnUndoNachruecken" type="button" class="btn btn-utility btn-sm" title="Nachr√ºcken r√ºckg√§ngig machen" style="display:none;">‚Ü©Ô∏è</button>
                        </span>
                    </legend>
                        <div class="form-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <div class="form-group"><label for="endeVJ">Ende VJ</label><input type="number" id="endeVJ" value="2318" min="0" step="0.01"></div>
                            <div class="form-group"><label for="endeVJ_1">Ende VJ-1</label><input type="number" id="endeVJ_1" value="1960" min="0" step="0.01"></div>
                            <div class="form-group"><label for="ath">Allzeithoch</label><input type="number" id="ath" value="2318" min="0" step="0.01"></div>
                            <div class="form-group"><label for="endeVJ_2">Ende VJ-2</label><input type="number" id="endeVJ_2" value="1850" min="0" step="0.01"></div>
                            <div class="form-group"><label for="endeVJ_3">Ende VJ-3</label><input type="number" id="endeVJ_3" value="1706" min="0" step="0.01"></div>
                            <div class="form-group"><label for="jahreSeitAth">Jahre seit ATH</label><input type="number" id="jahreSeitAth" value="0" step="0.01" min="0"></div>
                        </div>
                    </fieldset>
                    <fieldset><legend>Externe Eink√ºnfte</legend>
                      <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="form-group">
                          <label for="renteAktiv">Rente aktiv</label>
                          <select id="renteAktiv">
                            <option value="nein">Nein</option>
                            <option value="ja">Ja</option>
                          </select>
                        </div>
                        <div class="form-group" id="renteMonatlichGroup">
                          <label for="renteMonatlich">Gesetzl. Rente (‚Ç¨/Monat)</label>
                          <input id="renteMonatlich" class="currency" type="text" inputmode="numeric" value="0" disabled>
                        </div>
                      </div>
                    </fieldset>
                </div>

                <div id="tab-settings" class="tab-panel">
                    <fieldset><legend>Bedarfsplanung</legend>
						<div class="form-grid" style="grid-template-columns: 1fr 1fr;">
						    <div class="form-group"><label for="floorBedarf" title="Essenzielle Ausgaben pro Jahr">Floor-Bedarf p.a. (‚Ç¨)</label><input id="floorBedarf" class="currency" type="text" inputmode="numeric" value="24000"></div>
						    <div class="form-group"><label for="flexBedarf" title="W√ºnschenswerte, aber k√ºrzbare Ausgaben pro Jahr">Flex-Bedarf p.a. (‚Ç¨)</label><input id="flexBedarf" class="currency" type="text" inputmode="numeric" value="28000"></div>
						</div>
					</fieldset>
                    <fieldset><legend>Runway-Steuerung</legend>
                        <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="form-group">
                                <label for="runwayMinMonths" title="Das absolute Minimum an Liquidit√§tsreichweite, das nicht unterschritten werden soll. L√∂st im B√§renmarkt ggf. Not-Auff√ºllungen aus.">Runway Minimum (Monate)</label>
                                <input id="runwayMinMonths" type="number" value="24" min="12" max="60" step="1">
                            </div>
                            <div class="form-group">
                                <label for="runwayTargetMonths" title="Die angestrebte, komfortable Liquidit√§tsreichweite. Wird in guten Marktphasen proaktiv aufgef√ºllt (Skim & Fill).">Runway Ziel (Monate)</label>
                                <input id="runwayTargetMonths" type="number" value="36" min="18" max="72" step="1">
                            </div>
                        </div>
                    </fieldset>
                    <fieldset><legend>Rebalancing-Strategie</legend>
                        <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 15px 20px;">
                            <div class="form-group">
                                <label for="targetEq" title="Die angestrebte prozentuale Allokation in Aktien. Dient als Anker f√ºr das Rebalancing.">Aktien-Zielquote (%)</label>
                                <input id="targetEq" type="number" value="60" min="20" max="90" step="1">
                            </div>
                            <div class="form-group">
                                <label for="rebalBand" title="Die prozentuale Toleranz um die Zielquote, bevor ein Rebalancing ausgel√∂st wird.">Rebalancing-Band (¬±%)</label>
                                <input id="rebalBand" type="number" value="5" min="1" max="20" step="0.5">
                            </div>
                            <div class="form-group advanced-only">
                                <label for="maxSkimPctOfEq" title="Der maximal pro Jahr abzusch√∂pfende Betrag (als Prozentsatz des Aktiendepots), um die Liquidit√§t aufzuf√ºllen.">Max. Absch√∂pfen p.a. (%)</label>
                                <input id="maxSkimPctOfEq" type="number" value="10" min="0" max="25" step="1">
                            </div>
                            <!-- ============================================= -->
                            <!-- NEUES FELD F√úR BEAR-MODE-DRIP                 -->
                            <!-- ============================================= -->
                            <div class="form-group advanced-only">
                                <label for="maxBearRefillPctOfEq" title="Der maximal pro Jahr zu verkaufende Betrag (als Prozentsatz des Aktiendepots) im B√§renmarkt, um die Runway bis zum Minimum aufzuf√ºllen.">Max. Auff√ºllen (B√§r) (%)</label>
                                <input id="maxBearRefillPctOfEq" type="number" value="5" min="0" max="15" step="0.5">
                            </div>
                            <!-- ============================================= -->
                            <!-- ENDE NEUES FELD                               -->
                            <!-- ============================================= -->
                        </div>
                    </fieldset>
                    <fieldset class="advanced-only"><legend>Steuern</legend><div class="form-grid">
                        <div class="form-group"><label for="kirchensteuerSatz">Kirchensteuer</label><select id="kirchensteuerSatz"><option value="0">0 %</option><option value="0.08">8 %</option><option value="0.09" selected>9 %</option></select></div>
                        <div class="form-group"><label for="sparerPauschbetrag">Sparer-PB (‚Ç¨)</label><input id="sparerPauschbetrag" class="currency" type="text" inputmode="numeric" value="1000"></div>
                    </div></fieldset>
                    <fieldset class="advanced-only"><legend>Gold-Strategie</legend>
                        <div class="form-group full-width">
                            <label style="flex-direction: row; align-items: center; justify-content: center; padding: 5px 0;">
                                <input type="checkbox" id="goldAktiv" class="goldAktiv" style="width: auto; margin-right: 8px;">Gold-Allokation aktiv
                            </label>
                        </div>
                        <div id="goldPanel" style="display: none;">
                            <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr; gap: 15px 20px; align-items: end;">
                                <div class="form-group"><label for="goldZielProzent">Ziel-Allokation (% v. Depot)</label><input type="number" id="goldZielProzent" value="7.5" step="0.5"></div>
                                <div class="form-group"><label for="goldFloorProzent">Gold-Floor (% v. Gesamt)</label><input type="number" id="goldFloorProzent" value="1" step="0.5"></div>
                                <div class="form-group"><label for="rebalancingBand">Rebalancing-Band (¬±%)</label><input type="number" id="rebalancingBand" value="25" step="5"></div>
                                <div class="form-group full-width" style="grid-column: 1 / -1; justify-content:center; margin-top: 5px;"><label style="display:flex; align-items:center; flex-direction: row;"><input type="checkbox" id="goldSteuerfrei" style="width:auto; margin-right:8px;"> Gold-Verk√§ufe steuerfrei</label></div>
                            </div>
                        </div>
                    </fieldset>
                    <details id="einstandDetails" class="details-card advanced-only" aria-label="Einstandswerte"><summary aria-controls="einstandContent">Einstandswerte & Teilfreistellung</summary>
                        <div class="einstand-hinweis">Selten √§ndern ‚Äì wird automatisch gespeichert.</div>
                        <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr; gap: 20px; align-items: start;">
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div class="form-group"><label for="costBasisAlt">Einstand Alt (‚Ç¨)</label><input id="costBasisAlt" class="currency" type="text" inputmode="numeric" value="700000"></div>
                                <div class="form-group"><label for="tqfAlt">TQF Alt</label><input id="tqfAlt" type="number" step="0.01" min="0" max="1" value="0.30"></div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div class="form-group"><label for="costBasisNeu">Einstand Neu (‚Ç¨)</label><input id="costBasisNeu" class="currency" type="text" inputmode="numeric" value="750000"></div>
                                <div class="form-group"><label for="tqfNeu">TQF Neu</label><input id="tqfNeu" type="number" step="0.01" min="0" max="1" value="0.30"></div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div class="form-group"><label for="goldCost">Gold-Einstand (‚Ç¨)</label><input id="goldCost" class="currency" type="text" inputmode="numeric" value="0"></div>
                            </div>
                        </div>
                    </details>
                    
                    <details id="snapshot-management" class="details-card advanced-only" style="margin-top: 25px;">
                        <summary>Jahresabschluss-Snapshots</summary>
                        <div style="padding: 10px 0 5px 0;">
                            <button type="button" class="btn btn-sm" id="connectFolderBtn" style="width: 100%;">Lokalen Snapshot-Ordner verbinden</button>
                            <div id="snapshotStatus" class="snapshot-status">Speicherort: Browser (localStorage)</div>
                        </div>
                        <ul id="snapshotList" style="list-style: none; padding: 10px 0 0 0; margin: 0; font-size: 0.9rem;">
                        </ul>
                    </details>
					<button type="button" class="reset-button" id="resetBtn">Gespeicherte Werte zur√ºcksetzen</button>
                </div>
            </div>
        </div>
        <div class="results-column panel" role="region" aria-live="polite">
            <div id="results" role="status">
                <h2>
                    Ergebnisse & Handlungsschritte
                    <button id="openDiagnosisBtn" type="button" class="btn btn-sm btn-utility" title="Diagnosepanel √∂ffnen">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z"></path><path d="M12 18a6 6 0 0 0 0-12V2a10 10 0 0 0-9.9 12"></path><path d="M12 12h.01"></path></svg>
                        Diagnose
                    </button>
                </h2>
                <div class="mini-summary" id="miniSummary"></div>
                <div id="error-container" aria-live="polite"></div>
                <div class="result-item"><strong>Gesamt-Depotwert:</strong><span id="displayDepotwert"></span></div>
                <div class="result-item"><strong>Gesamtjahresbedarf:</strong><span id="neuerBedarf"></span></div>
                <div class="result-item" id="minGoldRow"><strong>Gold-Mindestbestand:</strong><span id="minGoldDisplay"></span></div>
                <hr>
                <div class="result-item"><strong>Ziel-Liquidit√§t:</strong><span id="zielLiquiditaet"></span></div>
                <div class="progress-bar-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"><div id="liquiditaetBalken" class="progress-bar"></div></div>
                <hr>
                <div class="result-item" id="marktstatusRow"><strong style="padding-right:10px">Marktsituation:</strong><span id="marktstatusText"></span></div>
                <div class="result-item"><strong>Monatliche Entnahme:</strong><span id="monatlicheEntnahme"></span></div>
                <details class="details-card" id="entnahme-breakdown" style="margin-top: 10px; display: none;"><summary>Details zur Entnahme</summary>
                    <div style="margin-top: 10px; font-size: 0.9rem; line-height: 1.5;" id="entnahmeDetailsContent"></div>
                </details>

                <div id="handlungsanweisung"><button id="copyAction" type="button" class="btn btn-sm btn-utility" title="Handlung kopieren">üìã</button></div>
                
                <div id="print-footer"></div>
            </div>
        </div>
    </div>

    <div id="drawerOverlay" class="drawer-overlay"></div>
    <div id="diagnosisDrawer" class="diagnosis-drawer" role="dialog" aria-modal="true" aria-labelledby="drawerTitle">
        <div class="drawer-header">
            <h3 id="drawerTitle">KI-Diagnose</h3>
            <div class="controls">
                <label style="font-weight:400; font-size: .8rem; margin:0;"><input type="checkbox" id="diagFilterToggle" style="width:auto; margin-right: 5px;">Nur aktive Regeln</label>
                <button id="copyDiagnosisBtn" type="button" class="btn btn-sm btn-utility" title="Diagnose kopieren">üìã</button>
                <button id="closeDiagnosisBtn" type="button" class="btn btn-sm" title="Schlie√üen">&times;</button>
            </div>
        </div>
        <div id="diagContent" class="drawer-content">
            <div class="diag-section">
                <h4>Status-√úbersicht</h4>
                <div id="diag-chips" class="diag-chips"></div>
            </div>
            <div class="diag-section">
                <h4>Entscheidungsbaum (Warum?)</h4>
                <ul id="diag-decision-tree"></ul>
            </div>
            <div class="diag-section">
                <h4>Guardrails</h4>
                <div id="diag-guardrails" class="diag-guardrails"></div>
            </div>
            <div class="diag-section">
                <h4>Transaktions-Diagnostik</h4>
                <div id="diag-transaction" class="diag-guardrails diag-transaction"></div>
            </div>
            <div class="diag-section">
                <h4>Schl√ºsselparameter (Intern)</h4>
                <div id="diag-key-params"></div>
            </div>
        </div>
    </div>

    <!-- Modal: Jahres-Update Ergebnis -->
    <div id="updateResultModal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">‚úÖ Jahres-Update erfolgreich</h3>
                <button class="modal-close" aria-label="Schlie√üen">&times;</button>
            </div>
            <div class="modal-body">
                <h4>üìä Durchgef√ºhrte Aktionen:</h4>
                <div id="modalResults" class="modal-results"></div>
                <div id="modalDuration" class="modal-duration"></div>
            </div>
            <div class="modal-footer">
                <button id="modalCloseBtn" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Mode Toggle Logic -->
    <script>
        (function() {
            const STORAGE_KEY = 'ruhestand-ui-mode';
            const modeToggle = document.getElementById('modeToggle');
            const body = document.body;

            // Load saved mode from localStorage (default: simple)
            const savedMode = localStorage.getItem(STORAGE_KEY) || 'simple';
            const isAdvanced = savedMode === 'advanced';

            // Set initial state
            modeToggle.checked = isAdvanced;
            if (!isAdvanced) {
                body.classList.add('mode-simple');
            }

            // Toggle handler
            modeToggle.addEventListener('change', function() {
                if (this.checked) {
                    // Advanced mode
                    body.classList.remove('mode-simple');
                    localStorage.setItem(STORAGE_KEY, 'advanced');
                } else {
                    // Simple mode
                    body.classList.add('mode-simple');
                    localStorage.setItem(STORAGE_KEY, 'simple');
                }
            });

            // Add helpful tooltips to key fields in simple mode
            function addTooltips() {
                const tooltips = {
                    'aktuellesAlter': 'Ihr aktuelles Lebensalter - wichtig f√ºr die Berechnung Ihrer Entnahmestrategien',
                    'inflation': 'Die Inflationsrate des letzten Jahres - wird automatisch von der EZB abgerufen',
                    'tagesgeld': 'Ihr Bargeld auf dem Tagesgeldkonto - sofort verf√ºgbar',
                    'geldmarktEtf': 'Ihr Geldmarkt-ETF - sehr sichere, kurzfristig verf√ºgbare Anlage',
                    'depotwertAlt': 'Der aktuelle Wert Ihres "alten" Depots (meist vor 2018 angelegt)',
                    'depotwertNeu': 'Der aktuelle Wert Ihres "neuen" Depots (meist nach 2018 angelegt)',
                    'floorBedarf': 'Ihre essentiellen j√§hrlichen Ausgaben, die Sie auf jeden Fall brauchen',
                    'flexBedarf': 'Ihre flexiblen j√§hrlichen Ausgaben, auf die Sie notfalls verzichten k√∂nnen',
                    'runwayMinMonths': 'Die Mindestmenge an Liquidit√§t (in Monaten), die Sie immer haben sollten',
                    'runwayTargetMonths': 'Ihre angestrebte komfortable Liquidit√§tsreichweite (in Monaten)',
                    'targetEq': 'Ihr Zielanteil an Aktien im Portfolio (in Prozent)',
                    'rebalBand': 'Die Toleranz, um die Ihre Aktienquote schwanken darf, bevor umgeschichtet wird'
                };

                Object.keys(tooltips).forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (!field) return;

                    const label = field.closest('.form-group')?.querySelector('label');
                    if (!label || label.querySelector('.help-tooltip')) return;

                    const tooltip = document.createElement('span');
                    tooltip.className = 'help-tooltip';
                    tooltip.innerHTML = `
                        <span class="help-icon">?</span>
                        <span class="tooltip-text">${tooltips[fieldId]}</span>
                    `;
                    label.appendChild(tooltip);
                });
            }

            // Add tooltips after DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', addTooltips);
            } else {
                addTooltips();
            }

            // Friendlier labels for simple mode
            const labelMappings = {
                'aktuellesAlter': { original: 'Aktuelles Alter', simple: 'Mein Alter' },
                'inflation': { original: 'Inflation VJ (%)', simple: 'Teuerung letztes Jahr (%)' },
                'tagesgeld': { original: 'Tagesgeld (‚Ç¨)', simple: 'Bargeld / Tagesgeld (‚Ç¨)' },
                'geldmarktEtf': { original: 'Geldmarkt-ETF (‚Ç¨)', simple: 'Geldmarkt-Fonds (‚Ç¨)' },
                'depotwertAlt': { original: 'Depotwert Alt (‚Ç¨)', simple: 'Depot "Alt" (‚Ç¨)' },
                'depotwertNeu': { original: 'Depotwert Neu (‚Ç¨)', simple: 'Depot "Neu" (‚Ç¨)' },
                'floorBedarf': { original: 'Floor-Bedarf p.a. (‚Ç¨)', simple: 'Notwendige Ausgaben pro Jahr (‚Ç¨)' },
                'flexBedarf': { original: 'Flex-Bedarf p.a. (‚Ç¨)', simple: 'Zus√§tzliche W√ºnsche pro Jahr (‚Ç¨)' },
                'runwayMinMonths': { original: 'Runway Minimum (Monate)', simple: 'Mindest-Liquidit√§t (Monate)' },
                'runwayTargetMonths': { original: 'Runway Ziel (Monate)', simple: 'Wunsch-Liquidit√§t (Monate)' },
                'targetEq': { original: 'Aktien-Zielquote (%)', simple: 'Aktien-Anteil (%)' },
                'rebalBand': { original: 'Rebalancing-Band (¬±%)', simple: 'Toleranz (¬±%)' }
            };

            function updateLabels() {
                const isSimple = body.classList.contains('mode-simple');
                Object.keys(labelMappings).forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (!field) return;

                    const label = field.closest('.form-group')?.querySelector('label');
                    if (!label) return;

                    // Store original if not already stored
                    if (!label.dataset.originalText) {
                        label.dataset.originalText = label.childNodes[0]?.textContent || '';
                    }

                    // Get the text node (first child, before any tooltip)
                    const textNode = label.childNodes[0];
                    if (textNode && textNode.nodeType === Node.TEXT_NODE) {
                        textNode.textContent = isSimple ?
                            labelMappings[fieldId].simple :
                            labelMappings[fieldId].original;
                    }
                });
            }

            // Update labels on toggle
            modeToggle.addEventListener('change', updateLabels);

            // Initial label update
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', updateLabels);
            } else {
                updateLabels();
            }
        })();
    </script>

</body>
</html>
